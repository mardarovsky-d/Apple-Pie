//
//  ViewController.swift
//  Apple Pie
//
//  Created by –î–º–∏—Ç—Ä–∏–π on 31.01.2021.
//

import UIKit

class ViewController: UIViewController {
    
    //MARK: - IB Outlets for UI components
    @IBOutlet weak var treeImageView: UIImageView!
    @IBOutlet var letterButtons: [UIButton]!
    @IBOutlet weak var correctWordLabel: UILabel!
    @IBOutlet weak var scoreLabel: UILabel!
    
    //MARK: - Properties
    var currentGame: Game!
    var capitalList = [ // —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤
        "–ê–±—É-–î–∞–±–∏",
        "–ê–±—É–¥–∂–∞",
        "–ê–¥–¥–∏—Å-–ê–±–µ–±–∞",
        "–ê–∫–∫—Ä–∞",
        "–ê–ª–∂–∏—Ä",
        "–ê–º–º–∞–Ω",
        "–ê–º—Å—Ç–µ—Ä–¥–∞–º",
        "–ê–Ω–¥–æ—Ä—Ä–∞-–ª–∞-–í–µ–ª—å—è",
        "–ê–Ω–∫–∞—Ä–∞",
        "–ê–Ω—Ç–∞–Ω–∞–Ω–∞—Ä–∏–≤—É",
        "–ê–ø–∏–∞",
        "–ê—Å–º—ç—Ä–∞",
        "–ê—Å—Ç–∞–Ω–∞",
        "–ê—Å—É–Ω—Å—å–æ–Ω",
        "–ê—Ñ–∏–Ω—ã",
        "–ê—à—Ö–∞–±–∞–¥",
        "–ë–∞–≥–¥–∞–¥",
        "–ë–∞–∫—É",
        "–ë–∞–º–∞–∫–æ",
        "–ë–∞–Ω–≥–∏",
        "–ë–∞–Ω–≥–∫–æ–∫",
        "–ë–∞–Ω–¥–∞—Ä-–°–µ—Ä–∏-–ë–∞–≥–∞–≤–∞–Ω",
        "–ë–∞–Ω–∂—É–ª",
        "–ë–∞—Å—Ç–µ—Ä",
        "–ë–µ–π—Ä—É—Ç",
        "–ë–µ–ª–≥—Ä–∞–¥",
        "–ë–µ–ª—å–º–æ–ø–∞–Ω",
        "–ë–µ—Ä–ª–∏–Ω",
        "–ë–µ—Ä–Ω",
        "–ë–∏—Å–∞—É",
        "–ë–∏—à–∫–µ–∫",
        "–ë—Ä–∞–∑–∑–∞–≤–∏–ª—å",
        "–ë—Ä–∞–∑–∏–ª–∏–∞",
        "–ë—Ä–∞—Ç–∏—Å–ª–∞–≤–∞",
        "–ë—Ä–∏–¥–∂—Ç–∞—É–Ω",
        "–ë—Ä—é—Å—Å–µ–ª—å",
        "–ë—É–¥–∞–ø–µ—à—Ç",
        "–ë—É–∂—É–º–±—É—Ä–∞",
        "–ë—É—Ö–∞—Ä–µ—Å—Ç",
        "–ë—É—ç–Ω–æ—Å-–ê–π—Ä–µ—Å",
        "–í–∞–¥—É—Ü",
        "–í–∞–ª–ª–µ—Ç—Ç–∞",
        "–í–∞—Ä—à–∞–≤–∞",
        "–í–∞—Ç–∏–∫–∞–Ω",
        "–í–∞—à–∏–Ω–≥—Ç–æ–Ω",
        "–í–µ–ª–ª–∏–Ω–≥—Ç–æ–Ω",
        "–í–µ–Ω–∞",
        "–í–∏–∫—Ç–æ—Ä–∏—è",
        "–í–∏–ª—å–Ω—é—Å",
        "–í–∏–Ω–¥—Ö—É–∫",
        "–í—å–µ–Ω—Ç—å—è–Ω",
        "–ì–∞–±–æ—Ä–æ–Ω–µ",
        "–ì–∞–≤–∞–Ω–∞",
        "–ì–≤–∞—Ç–µ–º–∞–ª–∞",
        "–î–∞–∫–∞—Ä",
        "–î–∞–∫–∫–∞",
        "–î–∞–º–∞—Å–∫",
        "–î–∂–∞–∫–∞—Ä—Ç–∞",
        "–î–∂–∏–±—É—Ç–∏",
        "–î–∂–æ—Ä–¥–∂—Ç–∞—É–Ω",
        "–î–∏–ª–∏",
        "–î–æ–¥–æ–º–∞",
        "–î–æ—Ö–∞",
        "–î—É–±–ª–∏–Ω",
        "–î—É—à–∞–Ω–±–µ",
        "–ï—Ä–µ–≤–∞–Ω",
        "–ó–∞–≥—Ä–µ–±",
        "–ò–µ—Ä—É—Å–∞–ª–∏–º",
        "–ò—Å–ª–∞–º–∞–±–∞–¥",
        "–ö–∞–±—É–ª",
        "–ö–∞–∏—Ä",
        "–ö–∞–º–ø–∞–ª–∞",
        "–ö–∞–Ω–±–µ—Ä—Ä–∞",
        "–ö–∞—Ä–∞–∫–∞—Å",
        "–ö–∞—Å—Ç—Ä–∏",
        "–ö–∞—Ç–º–∞–Ω–¥—É",
        "–ö–∏–≥–∞–ª–∏",
        "–ö–∏–µ–≤",
        "–ö–∏–Ω–≥—Å—Ç–∞—É–Ω",
        "–ö–∏–Ω–≥—Å—Ç–æ–Ω",
        "–ö–∏–Ω—à–∞—Å–∞",
        "–ö–∏—Ç–æ",
        "–ö–∏—à–∏–Ω–µ–≤",
        "–ö–æ–ª–æ–º–±–æ",
        "–ö–æ–Ω–∞–∫—Ä–∏",
        "–ö–æ–ø–µ–Ω–≥–∞–≥–µ–Ω",
        "–ö—É–∞–ª–∞-–õ—É–º–ø—É—Ä",
        "–õ–∏–±—Ä–µ–≤–∏–ª—å",
        "–õ–∏–ª–æ–Ω–≥–≤–µ",
        "–õ–∏–º–∞",
        "–õ–∏—Å—Å–∞–±–æ–Ω",
        "–õ–æ–º–µ",
        "–õ–æ–Ω–¥–æ–Ω",
        "–õ—É–∞–Ω–¥–∞",
        "–õ—É—Å–∞–∫–∞",
        "–õ—é–±–ª—è–Ω–∞",
        "–õ—é–∫—Å–µ–º–±—É—Ä–≥",
        "–ú–∞–¥–∂—É—Ä–æ",
        "–ú–∞–¥—Ä–∏–¥",
        "–ú–∞–ª–∞–±–æ",
        "–ú–∞–ª–µ",
        "–ú–∞–Ω–∞–≥—É–∞",
        "–ú–∞–Ω–∞–º–∞",
        "–ú–∞–Ω–∏–ª–∞",
        "–ú–∞–ø—É—Ç—É",
        "–ú–∞—Å–µ—Ä—É",
        "–ú–∞—Å–∫–∞—Ç",
        "–ú–±–∞–±–∞–Ω–µ",
        "–ú–µ–ª–µ–∫–µ–æ–∫",
        "–ú–µ—Ö–∏–∫–æ",
        "–ú–∏–Ω—Å–∫",
        "–ú–æ–≥–∞–¥–∏—à–æ",
        "–ú–æ–Ω–∞–∫–æ",
        "–ú–æ–Ω—Ä–æ–≤–∏—è",
        "–ú–æ–Ω—Ç–µ–≤–∏–¥–µ–æ",
        "–ú–æ—Ä–æ–Ω–∏",
        "–ú–æ—Å–∫–≤–∞",
        "–ù–∞–π–ø—å–∏–¥–æ",
        "–ù–∞–π—Ä–æ–±–∏",
        "–ù–∞—Å—Å–∞—É",
        "–ù–¥–∂–∞–º–µ–Ω–∞",
        "–ù–∏–∞–º–µ–π",
        "–ù–∏–∫–æ—Å–∏—è",
        "–ù—É–∞–∫—à–æ—Ç",
        "–ù—É–∫—É–∞–ª–æ—Ñ–∞",
        "–ù—å—é-–î–µ–ª–∏",
        "–û—Å–ª–æ",
        "–û—Ç—Ç–∞–≤–∞",
        "–ü–∞–ª–∏–∫–∏—Ä",
        "–ü–∞–Ω–∞–º–∞",
        "–ü–∞—Ä–∞–º–∞—Ä–∏–±–æ",
        "–ü–∞—Ä–∏–∂",
        "–ü–µ–∫–∏–Ω",
        "–ü–Ω–æ–º–ø–µ–Ω—å",
        "–ü–æ–¥–≥–æ—Ä–∏—Ü–∞",
        "–ü–æ—Ä—Ç-–í–∏–ª–∞",
        "–ü–æ—Ä—Ç-–õ—É–∏",
        "–ü–æ—Ä—Ç-–ú–æ—Ä—Å–±–∏",
        "–ü–æ—Ä—Ç–æ-–ù–æ–≤–æ",
        "–ü–æ—Ä—Ç-–æ-–ü—Ä–µ–Ω—Å",
        "–ü–æ—Ä—Ç-–æ—Ñ-–°–ø–µ–π–Ω",
        "–ü—Ä–∞–≥–∞",
        "–ü—Ä–∞—è",
        "–ü—Ä–µ—Ç–æ—Ä–∏—è",
        "–ü—Ö–µ–Ω—å—è–Ω",
        "–†–∞–±–∞—Ç",
        "–†–µ–π–∫—å—è–≤–∏–∫",
        "–†–∏–≥–∞",
        "–†–∏–º",
        "–†–æ–∑–æ",
        "–°–∞–Ω–∞",
        "–°–∞–Ω-–ú–∞—Ä–∏–Ω–æ",
        "–°–∞–Ω-–°–∞–ª—å–≤–∞–¥–æ—Ä",
        "–°–∞–Ω—Ç–∞-–§–µ-–¥–µ-–ë–æ–≥–æ—Ç–∞",
        "–°–∞–Ω—Ç–æ-–î–æ–º–∏–Ω–≥–æ",
        "–°–∞–Ω-–¢–æ–º–µ",
        "–°–∞–Ω—Ç—å—è–≥–æ",
        "–°–∞–Ω-–•–æ—Å–µ",
        "–°–∞—Ä–∞–µ–≤–æ",
        "–°–µ–Ω—Ç-–î–∂–æ–Ω—Å",
        "–°–µ–Ω—Ç-–î–∂–æ—Ä–¥–∂–µ—Å",
        "–°–µ—É–ª",
        "–°–∏–Ω–≥–∞–ø—É—Ä",
        "–°–∫–æ–ø—å–µ",
        "–°–æ—Ñ–∏—è",
        "–°—Ç–æ–∫–≥–æ–ª—å–º",
        "–°—É–≤–∞",
        "–°—É–∫—Ä–µ",
        "–¢–∞–ª–ª–∏–Ω",
        "–¢–∞—à–∫–µ–Ω—Ç",
        "–¢–±–∏–ª–∏—Å–∏",
        "–¢–µ–≥–µ—Ä–∞–Ω",
        "–¢–µ–≥—É—Å–∏–≥–∞–ª—å–ø–∞",
        "–¢–∏—Ä–∞–Ω–∞",
        "–¢–æ–∫–∏–æ",
        "–¢—Ä–∏–ø–æ–ª–∏",
        "–¢—É–Ω–∏—Å",
        "–¢—Ö–∏–º–ø—Ö—É",
        "–£–∞–≥–∞–¥—É–≥—É",
        "–£–ª–∞–Ω-–ë–∞—Ç–æ—Ä",
        "–§—Ä–∏—Ç–∞—É–Ω",
        "–§—É–Ω–∞—Ñ—É—Ç–∏",
        "–•–∞–Ω–æ–π",
        "–•–∞—Ä–∞—Ä–µ",
        "–•–∞—Ä—Ç—É–º",
        "–•–µ–ª—å—Å–∏–Ω–∫–∏",
        "–•–æ–Ω–∏–∞—Ä–∞",
        "–≠–ª—å-–ö—É–≤–µ–π—Ç",
        "–≠—Ä-–†–∏—è–¥",
        "–Æ–∂–Ω–∞—è –¢–∞—Ä–∞–≤–∞",
        "–Ø–º—É—Å—É–∫—Ä–æ",
        "–Ø—É–Ω–¥–µ",
    ].shuffled()
    let incorrectMovesAllowed = 7 // –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –ø–æ–ø—ã—Ç–æ–∫
    var totalLosses = 0 { // –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –ø—Ä–æ–∏–≥—Ä—ã—à–µ–π
        didSet {
            showLoseAlert() // –µ—Å–ª–∏ –º–µ–Ω—è–µ—Ç—Å—è –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ
            newRound() // –∑–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π —Ä–∞—É–Ω–¥
        }
    }
    var totalWins = 0 { // –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ –ø–æ–±–µ–¥
        didSet {
            showWinAlert() // –µ—Å–ª–∏ –º–µ–Ω—è–µ—Ç—Å—è –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ
            newRound() // –∑–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π —Ä–∞—É–Ω–¥
        }
    }
    
    //MARK: - Methods
    func enableButtons(_ enable: Bool = true) { // –≤–∫–ª—é—á–∞–µ–º –∏–ª–∏ –≤—ã–∫–ª—é—á–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–æ–∫ —Å –±—É–∫–≤–∞–º–∏
        for button in letterButtons {
            button.isEnabled = enable
        }
    }
    
    func newRound() { // –ù–æ–≤—ã–π —Ä–∞—É–Ω–¥
        guard !capitalList.isEmpty else {
            updateUI()
            enableButtons(false)
            return
        }
        let newWord = capitalList.removeFirst()
        currentGame = Game(word: newWord, incorrectMovesRemaining: incorrectMovesAllowed)
        updateUI()
        enableButtons()
    }
    
    func showLoseAlert() { // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –∞–ª–µ—Ä—Ç–∞ –æ –ø—Ä–æ–∏–≥—Ä—ã—à–µ
        let loseAlert = UIAlertController(title: "üòí –ù–µ–≤–µ—Ä–Ω–æ", message: "–í—ã –Ω–µ —É–≥–∞–¥–∞–ª–∏. –≠—Ç–æ \(currentGame.word)", preferredStyle: .alert)
        loseAlert.addAction(UIAlertAction(title: "OK", style: .default, handler: nil))
        self.present(loseAlert, animated: true)
    }
    
    func showWinAlert() { // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –∞–ª–µ—Ä—Ç–∞ –æ –≤—ã–∏–≥—Ä—ã—à–µ
        let winAlert = UIAlertController(title: "üòÄ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!", message: "–í—ã —É–≥–∞–¥–∞–ª–∏. –≠—Ç–æ \(currentGame.word)!", preferredStyle: .alert)
        winAlert.addAction(UIAlertAction(title: "OK", style: .default, handler: nil))
        self.present(winAlert, animated: true)
    }
    
    func updateCorrectWordLabel() { // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–±–µ–ª—ã –≤ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ —Å–ª–æ–≤–æ
        var updatedWord = [String]() // —Å–æ–∑–¥–∞—ë–º –ø—É—Å—Ç—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é
        for updatedLetter in currentGame.guessedWord { // –¥–æ–±–∞–≤–ª—è–µ–º –±—É–∫–≤—ã –∏–∑ –∏—Å–∫–æ–º–æ–≥–æ —Å–ª–æ–≤–∞ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é
            updatedWord.append(String(updatedLetter))
        }
        correctWordLabel.text = updatedWord.joined(separator: " ") // —Å–æ–µ–¥–∏–Ω—è–µ–º –≤ —Å–ª–æ–≤–æ, –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ - –ø—Ä–æ–±–µ–ª
    }
    
    func updateState() { // –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        if currentGame.incorrectMovesRemaining < 1 { // –µ—Å–ª–∏ –ø–æ–ø—ã—Ç–æ–∫ –º–µ–Ω—å—à–µ 1
            totalLosses += 1 // —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —á–∏—Å–ª–æ –ø—Ä–æ–∏–≥—Ä—ã—à–µ–π
        } else if currentGame.guessedWord == currentGame.word { // –µ—Å–ª–∏ —É–≥–∞–¥—ã–≤–∞–µ–º–æ–µ —Å–ª–æ–≤–æ –Ω–∞–π–¥–µ–Ω–æ
            totalWins += 1 // —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —á–∏—Å–ª–æ –ø–æ–±–µ–¥
        } else {
            updateUI() // –∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏–≥—Ä–∞—Ç—å
        }
        updateUI()
    }
    
    func updateUI() { // –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        let movesRemaining = currentGame.incorrectMovesRemaining // –æ—Å—Ç–∞–ª–æ—Å—å –Ω–µ–≤–µ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
        let imageName = "tree\(movesRemaining < 0 ? 0 : movesRemaining < 8 ? movesRemaining : 7)" // –º–µ–Ω—è–µ–º –¥–µ—Ä–µ–≤–æ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ø—ã—Ç–æ–∫
        treeImageView.image = UIImage(named: imageName)
        scoreLabel.text = "–í—ã–∏–≥—Ä—ã—à–∏: \(totalWins). –ü—Ä–æ–∏–≥—Ä—ã—à–∏: \(totalLosses)" // –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —á–∏—Å–ª–æ –ø—Ä–æ–∏–≥—Ä—ã—à–µ–π –∏ –≤—ã–∏–≥—Ä—ã—à–µ–π
        updateCorrectWordLabel() // –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ª–æ–≤–æ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
    }
    
    override func viewDidLoad() { // –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –í—å—é
        super.viewDidLoad()
        newRound() // –∑–∞–ø—É—Å–∫–∞–µ–º —Ä–∞—É–Ω–¥
    }

    //MARK: - IB Actions
    @IBAction func letterButtonPressed(_ sender: UIButton) { // –æ–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫–∞—è –±—É–∫–≤–∞ –Ω–∞–∂–∞—Ç–∞
        sender.isEnabled = false
        let letter = sender.title(for: .normal)!
        currentGame.playerGuessed(letter: Character(letter))
        updateState()
    }
    
}
